# OSM Data Mining

alles wird anders

# straigt

Find straight roads and optionally visualise them on an interactive map.

## Usage

```
python find_straight_ways.py pbf/saarland-latest.osm.pbf \
    --min-length 1000 --min-straightness 0.99 --map result.html

# advanced version joining adjacent segments
python find_straight_ways_v02.py pbf/saarland-latest.osm.pbf \
    --min-length 1000 --min-straightness 0.99 --no-secondary

# experimental version using Shapely for geometry merging
python find_straight_ways_v04.py pbf/saarland-latest.osm.pbf \
    --min-length 1000 --min-straightness 0.99 --simplify 0.0001
```

The `--map` option writes an HTML file with the found ways drawn using
[Folium](https://python-visualization.github.io/folium/). Install the
dependency with `pip install folium` if it is not already available.

In `find_straight_ways_v02.py` motorways are ignored and primary or secondary
roads can be excluded using the `--no-primary` and `--no-secondary` options.

`find_straight_ways_v04.py` uses [Shapely](https://shapely.readthedocs.io/) to
merge connected road segments irrespective of name tags before searching for
straight runs. An optional simplification step can remove small kinks from the
geometry. The script remains experimental and may require tuning the
`--simplify` parameter depending on the region.

## Longest lines in images

The script `longest_lines.py` scans all PNG files in a directory and reports the
five longest straight line segments in each. Install the optional dependency
`opencv-python` (or `scikit-image`) before running it:

```
pip install opencv-python
```

Example:

```
python longest_lines.py images --visualize --out out
```

This will write copies of the input images with the longest lines drawn as a
thick red overlay in the `out/` directory.

## HTML overlays for PNG layers

`png_overlay_html.py` creates small HTML files that display the PNG images
generated by `find_straight_ways_visual_v01.py` on top of a base map. Provide
the geographical bounds of the images (min/max longitude and latitude) and the
script will write an HTML file next to each PNG:

```
python png_overlay_html.py out/ \
    --bounds 7.0 49.0 7.5 49.5 --opacity 0.5
```

Open the resulting `*.html` files in a browser to compare the overlay with the
actual map data. The script uses [Folium](https://python-visualization.github.io/folium/);
install it with `pip install folium` if necessary.

## Find house number 8 north of unclassified roads

`find_housenumber8_north.py` searches for buildings with `addr:housenumber=8` that
lie north of the nearest `highway=unclassified` segment at a distance between
50–150 m. The result is written to an interactive HTML map with separate layers
for roads and buildings.

For best performance pre-filter the PBF file:

```
osmium tags-filter pbf input.osm.pbf \
    w/highway=unclassified w/building addr:housenumber=8 -o filtered.pbf
python find_housenumber8_north.py filtered.pbf --out houses.html
```

Alternatively let the script run the filtering step:

```
python find_housenumber8_north.py input.osm.pbf --prefilter --out houses.html
```

The script indexes road segments in an R-tree and evaluates building distances
in parallel. Use `--processes` to control the worker count.
